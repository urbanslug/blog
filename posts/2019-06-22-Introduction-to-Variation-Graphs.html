<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <link rel="apple-touch-icon" sizes="57x57" href="../images/favicon/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="../images/favicon/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="../images/favicon/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="../images/favicon/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="../images/favicon/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="../images/favicon/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="../images/favicon/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="../images/favicon/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192" href="../images/favicon/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="../images/favicon/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon/favicon-16x16.png">
        <link rel="manifest" href="../images/favicon/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <title>An Introduction to Variation Graphs urbanslug</title>
    </head>
    <body>
      <div id="wrapper">
        <header>
          <div id="header-content">
            <nav>
                <a href="../">Home</a>
                <a href="../notes.html">Notes</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../subscribe.html">Subscribe</a>
            </nav>
          </div><!--header-content-->
        </header>
        <article>
          <h1>An Introduction to Variation Graphs</h1>
          <div class="info">
    Posted on June 22, 2019
    
</div>
<div class="info">
    
    Tags: <a href="../tags/biology.html">biology</a>, <a href="../tags/variation%20graphs.html">variation graphs</a>, <a href="../tags/graphs.html">graphs</a>, <a href="../tags/bioinformatics.html">bioinformatics</a>, <a href="../tags/genetics.html">genetics</a>
    
</div>

<h1 id="background">Background</h1>
<p>This post is aimed at both programmers and biologists; for this reason, I will try to bring the reader up to speed on a topic before going into it. If you feel that you’re already familiar with a concept feel free to skip the sentence, paragraph or even section.</p>
<h2 id="genome-sequencing">Genome sequencing</h2>
<p>A <strong><a href="https://en.wikipedia.org/wiki/Genome">genome</a></strong> is the entire genetic code of an organism. While computational data is represented in binary form, ones and zeros, biochemical data is represented by nitrogenous <a href="https://en.wikipedia.org/wiki/Base_(chemistry)">bases</a> that seem to stick out of a <a href="https://en.wikipedia.org/wiki/DNA">DNA</a> or <a href="https://en.wikipedia.org/wiki/RNA">RNA</a> molecule/strand abbreviated A,T,C and G for DNA and A,G,C and U for RNA. The reason RNA matters in this context is because some viruses have RNA and not DNA.</p>
<p>If this is confusing, you can think of a strand of DNA or RNA as a thread with knots where each knot is a base.</p>
<p>A <strong>sequence</strong> is an <em>ordering</em> of something. A programming analogue would be sequences vs collections. Sequences are ordered, for example lists, and therefore have the potential for a <em>next</em> and a <em>previous</em> element while collections are just data thrown together, for example a dictionary or a set.</p>
<p><strong>Genome sequencing</strong> (or sequencing a genome) therefore, is determining the order of bases in all of the DNA or RNA in an organism. What makes this easy is that all the cells in an individual organism have the same exact DNA so we can get all the DNA in an organism from a single cell. In practice however, we can’t work with a single cell due to it’s size. Ignore chromosomes, haplotypes and other things you may know about DNA for now.</p>
<p>To determine the sequence of bases in an entire genome of an organism we focus on only one of the chromosomes (a <strong>haplotype</strong>) and only one strands of the double helix. Since 2005 we’ve used methods broadly categorized under <strong>Next Generation Sequencing (NGS)</strong> to perform genome sequencing. There are two main ways of performing NGS:</p>
<ol style="list-style-type: decimal">
<li>Shear the DNA into small fragments, sequence those and try to build back the original sequence. An analogy that’s used is shredding a newspaper article then trying to recreate it.</li>
<li>Run the DNA strand like a train would run through a tunnel through a pore and read the sequence of bases. There are other methods of reading entire strands of DNA but they don’t matter in this context.</li>
</ol>
<p>As you would expect, each method has its drawbacks and advantages. What we get out of the machine that does the actual sequencing of DNA is called a read and reads have to be <a href="https://en.wikipedia.org/wiki/Sequence_alignment">aligned</a> and <a href="https://en.wikipedia.org/wiki/Sequence_assembly">assembled</a>[2]. Alignment involves stacking reads on top of each other and assembling is the entire process that involves alignment,algorithmically choosing the best alignment and determining what the original sequence was.</p>
<p>There are two broad categories of assembly[4]:</p>
<ul>
<li><strong>De-novo assembly:</strong> this is where we sequence a genome that has never been sequenced before</li>
<li><strong>Mapping assembly:</strong> this is sequencing an organism’s unique code despite having the general sequence for the species. What you get from services like <a href="https://www.23andme.com/en-int/">23andMe</a>.</li>
</ul>
<h2 id="the-reference-genome">The reference genome</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Reference_genome">reference genome</a> is a consensus sequence that accepted as the genome of a species [2]. It’s stored as one long sequence of characters/bases. You may wonder “How we can have a known genome of an entire species when every individual has a unique genetic code?” or “If everyone is different, how are <strong>humans</strong> <a href="https://www.scientificamerican.com/article/tiny-genetic-differences-between-humans-and-other-primates-pervade-the-genome/">99% chimp</a>?”. Well the answer is that most organism’s genetic code is similar and this similarity increases as we narrow down taxonomically. When we say that <a href="https://www.scientificamerican.com/article/tiny-genetic-differences-between-humans-and-other-primates-pervade-the-genome/">a human is closer to a chimp than a monkey</a> it’s because we can see more differences between the genomes of the two man+chimp vs monkey than man vs chimp alone.</p>
<h2 id="variation-in-genomes">Variation in genomes</h2>
<p>However, there are still differences that make us different from one another and they shouldn’t be ignored. A better way to describe them is to say that the differences are segregating within the population, We may also want to carry out comparison between species or between related species which is done in <a href="https://en.wikipedia.org/wiki/Pan-genome">pangenomics</a>.</p>
<p>DNA has sections which are identical between individuals (conserved regions), and the number of these sections grows as we narrow down taxonomically and there are sections which vary between individuals, for example the short sequence repeats that are compared in paternity testing.</p>
<p><a href="https://en.wikipedia.org/wiki/Graph_theory">Graph theory</a> is an area in math that can helps us understand variable regions within genomes. The idea of representing genomes as graphs isn’t new, however, the low number of tools like <a href="https://github.com/vgteam/vg">vg</a> which apply graph theory to genomics and the little that we know about genomes has been an issue.</p>
<h1 id="graphs">Graphs</h1>
<p>A <a href="https://en.wikipedia.org/wiki/Graph_theory">graph</a> is a series of vertices (also known as nodes) and edges. <img src="../images/Content/Graphs/all_graphs.png" alt="all graphs" /></p>
<p>For genome graphs we focus on directed acyclic graphs.<br />
A <strong>walk</strong> in a directed graph is traversal from one node to another through an edge for example, <em>a</em> to <em>b</em> to <em>d</em> or <em>a</em> to <em>c</em> to <em>d</em>. <img src="../images/Content/Graphs/directed_graph.png" alt="directed graph" /></p>
<h2 id="the-current-state-of-affairs">The current state of affairs</h2>
<p>Once the reference genome of an organism has been determined, it is stored in <a href="https://en.wikipedia.org/wiki/FASTA_format">fasta format</a> which contains the sequence and metadata. Moving forward, anyone sequencing the same species aligns against this reference. Differences that occur in less than 1% of the reads are usually thrown out; the ones that aren’t thrown out however don’t help to update the reference but are however stored in <a href="https://en.wikipedia.org/wiki/Variant_Call_Format">Variant Call Format (VCF)</a> which contains the variation data and their positions plus metadata. These VCF files are spread out amongst researchers and aid in the particular thing being researched but generally don’t contribute in and of themselves to the general genomic body of knowledge. However, every once in a while the reference is updated but not on a fixed schedule [2]. It’s for this reason that the variation graph would be a good way of representing the reference. There has also been research that shows that short reads align better to the graph than they do to a reference [3].</p>
<h1 id="graphs-and-genomes">Graphs and genomes</h1>
<p>Graphs that are applied to genomes are generally called <strong>genome graphs</strong>. However there are two more specific categories which are sequence graphs and variation graphs.</p>
<p>As an example assume that we zoom on a hypothetical reference: <strong>“ACTGAATTTGTA”</strong></p>
<table>
<thead>
<tr class="header">
<th align="center">Variation</th>
<th align="center">Position</th>
<th align="center">Alternative</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Variation1</td>
<td align="center">2</td>
<td align="center">GGGA</td>
</tr>
<tr class="even">
<td align="center">Variation2</td>
<td align="center">4</td>
<td align="center">C</td>
</tr>
</tbody>
</table>
<p>We could recursively insert Variation1 at position 2 and Variation2 at position 4 to generate the graph below:</p>
<p><img src="../images/Content/Graphs/example.png" alt="sequence graph" /> (generated using <a href="https://github.com/urbanslug/graphite">graphite</a> and my current fork of graph)</p>
<p>In this case a single walk would represent a possible genome. Compared to the reference, this variation information is maintained and the graph still holds the data that was in reference.</p>
<h2 id="sequence-graphs">Sequence Graphs</h2>
<p>This are graphs with sequence labels on the nodes or edges.</p>
<p>Sequence graphs or equivalent structures have been used previously to represent multiple sequences that contain shared differences or ambiguities in a single structure. Related structures used in genome assembly which collapse long repeated sequences, so the same nodes are used for different regions of the genome include the <a href="https://en.wikipedia.org/wiki/De_Bruijn_graph">De Bruijn graph</a>.[5] Graphs to represent genetic variation have previously been used for microbial genomes &amp; localized regions of the human genome such as the major <a href="https://en.wikipedia.org/wiki/Histocompatibility">histocompatibility</a> complex.</p>
<h2 id="variation-graphs">Variation Graphs</h2>
<p>A variation graph is a sequence graph together with a set of paths representing possible sequences from a population.</p>
<h2 id="variation-graphs-and-rsv">Variation graphs and RSV</h2>
<p><a href="https://en.wikipedia.org/wiki/Human_orthopneumovirus">Human orthopneumovirus</a>, formerly known as Respiratory Syncytial Virus (RSV), is a single stranded RNA virus and a good candidate for exploration using the variation graph because viruses don’t have proofreading in their genetic code. Proofreading is a process in which the cell ensures that it has copied the genetic code correctly in preparation for cell division. Without proofreading errors will be common leading to high mutation rates. Another advantage is the size of its genome; the reference stands at 15,206 bases which translates to 15206 bytes or 14.8 KB of memory.</p>
<h1 id="generating-a-variation-graph">Generating a variation graph</h1>
<p>I’m going to describe the method used by graphite for building the graph. As of writing this, <a href="https://github.com/urbanslug/graphite">graphite</a> can’t generate a graph out of reads alone. It supports a reference in fasta and a single VCF file.</p>
<h2 id="algorithm">Algorithm</h2>
<p>The general idea is:</p>
<ol style="list-style-type: decimal">
<li>Read in the entire reference into memory</li>
<li>Treat this reference as a single string (no streaming, storing as integers, bytestring or any fancy optimizations)</li>
<li>Create a singleton list that holds this string
<ul>
<li>This singleton list is a single node graph</li>
</ul></li>
</ol>
<p>Read a variton into memory of position <code>p</code> and variation sequence or SNP <code>var</code></p>
<p>Update the graph by</p>
<ol style="list-style-type: decimal">
<li>Create a singleton list holding the variation, <code>var</code>.</li>
<li>Split the string in the node we are interested in at <code>p</code> into:
<ol style="list-style-type: lower-alpha">
<li><code>prev</code></li>
<li><code>seq-at-pos</code></li>
<li><code>next</code></li>
</ol></li>
<li>Create a new list containing nested lists (dynamic tree?).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">[
  prev,
    [var, [<span class="bu">next</span>]],
    [[seq<span class="op">-</span>at<span class="op">-</span>pos], <span class="bu">next</span>]
]</code></pre></div>
<h2 id="variation">Variation</h2>
<p>A variation is a struct of <code>position</code> and <code>sequence</code>.</p>
<p>I’m using the <a href="https://github.com/stchang/graph">racket graph library graph</a> to generate a graph out of the nested lists and I’m treating the graph as a “dynamic tree”.</p>
<p>We then rely on graph to generate an unweighted directed graph through <a href="https://docs.racket-lang.org/graph/index.html#%28def._%28%28lib._graph%2Fmain..rkt%29._unweighted-graph%2Fdirected%29%29">unweighted-graph/directed</a>. We export the graph in dot format and visualize for now, serialization isn’t yet implemented.</p>
<h1 id="references">References</h1>
<ol style="list-style-type: decimal">
<li>Adam M. Novak, Erik Garrison, Benedict Paten A graph extension of the positional burrows-wheeler transform and its applications bioRxiv 051409; doi: https://doi.org/10.1101/051409</li>
<li>Church DM, Schneider VA, Graves T, Auger K, Cunningham F, Bouk N, et al. (2011) Modernizing Reference Genome Assemblies. PLoS Biol 9(7): e1001091. https://doi.org/10.1371/journal.pbio.1001091</li>
<li>Garrison, Erik &amp; Sirén, Jouni &amp; M Novak, Adam &amp; Hickey et al. (2018). Variation graph toolkit improves read mapping by representing genetic variation in the reference. Nature Biotechnology. 36. 10.1038/nbt.4227</li>
<li>Wolf, Beat. “De novo genome assembly versus mapping to a reference genome” (PDF). University of Applied Sciences Western Switzerland. Retrieved 6 April 2019.</li>
<li>Holley, Guillaume &amp; Peterlongo, Pierre. (2012). BLASTGRAPH: Intensive approximate pattern matching in sequence graphs and de-Bruijn graphs. Proceedings of the Prague Stringology Conference, PSC 2012.</li>
</ol>

<script src="https://carnivalapp.io/sites/413/init.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", Carnival.init);
</script>

        </article>

        <footer>
  <p>All work is under the terms of the <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License, Version 1.3</a></p>
  <p>Generated with <a href="https://jaspervdj.be/hakyll/">Hakyll</a>.</p>
        </footer>
      </div> <!-- #wrapper -->
    </body>
</html>
